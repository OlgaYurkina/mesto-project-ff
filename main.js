(()=>{"use strict";var e="",t="88b11ee7-a8a1-438d-9ad0-3ad46297d70f",n="https://nomoreparties.co/v1/".concat("wff-cohort-29","/"),o={headers:{authorization:t,"Content-Type":"application/json"}};const r=e+"75438e944a43e4c0b404.svg",c=e+"49570bcb1d637fdb38e5.svg";function u(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",i)}function a(e){e.classList.add("popup_is-animated"),e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&a(t)}}function l(e,t,n){var o=e._id,u=e.name,i=e.link,l=e.likes,s=e.owner,d=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),p=d.querySelector(".card__image"),f=d.querySelector(".card__title"),m=d.querySelector(".card__delete-button"),_=d.querySelector(".card__like-button"),y=d.querySelector(".card__like-count");return p.src=i,p.alt=u,f.textContent=u,_.style.backgroundImage=l.some((function(e){return e._id===n}))?"url(".concat(r,")"):"url(".concat(c,")"),y.textContent=l.length,s._id!==n?m.style.display="none":(m.style.display="block",m.addEventListener("click",(function(){return function(e,t){var n=document.querySelector(".popup_type_confirm-delete"),o=n.querySelector(".popup__confirm-button"),r=n.querySelector(".popup__cancel-button");n.classList.add("popup_is-opened"),o.addEventListener("click",(function(){!function(e){fetch("https://nomoreparties.co/v1/cohortId/cards/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(e){e.message&&console.log("Карточка удалена:",e)})).catch((function(e){return console.log("Ошибка при удалении карточки:",e)}))}(t),e.remove(),a(n)})),r.addEventListener("click",(function(){return a(n)}))}(d,o)}))),_.addEventListener("click",(function(){return function(e,t,n,o){var u=e.classList.toggle("card__like-button_is-active");e.style.backgroundImage="url(".concat(u?r:c,")"),u?n.likes.push({_id:o}):n.likes=n.likes.filter((function(e){return e._id!==o})),t.textContent=n.likes.length}(_,y,{name:u,link:i,likes:l},n)})),p.addEventListener("click",(function(){return t(u,i)})),d}function s(e,t,n){var o=e.closest(n.formSelector).querySelector("#".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),o.textContent=t,o.classList.add(n.errorClass)}function d(e,t){e.validity.valid?function(e,t){var n=e.closest(t.formSelector).querySelector("#".concat(e.id,"-error"));e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent=""}(e,t):s(e,e.validationMessage,t)}function p(e,t,n){var o=e.every((function(e){return e.validity.valid}));t.disabled=!o,t.classList.toggle(n.inactiveButtonClass,!o)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var m,_=document.querySelector(".places__list"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_new-card"),h=v.querySelector(".popup__close"),S=v.querySelector("form"),b=S.querySelector('input[name="place-name"]'),q=S.querySelector('input[name="link"]'),g=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),E=k.querySelector("form"),L=E.querySelector('input[name="name"]'),C=E.querySelector('input[name="description"]'),j=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),A=k.querySelector(".popup__close"),w=document.querySelector(".popup_type_image"),I=w.querySelector(".popup__image"),P=w.querySelector(".popup__caption"),B=w.querySelector(".popup__close"),T=document.querySelector(".popup_type_confirm-delete"),O=document.querySelector(".profile__avatar-edit-button"),D=document.querySelector(".popup_type_edit-avatar"),z=D.querySelector('input[name="avatar"]'),N=D.querySelector(".popup__button"),J=D.querySelector(".popup__close"),H=null;function M(e,t){I.src=t,I.alt=e,P.textContent=e,u(w)}y.addEventListener("click",(function(){return u(v)})),h.addEventListener("click",(function(){return a(v)})),g.addEventListener("click",(function(){L.value=j.textContent,C.value=x.textContent,u(k)})),A.addEventListener("click",(function(){return a(k)})),E.addEventListener("submit",(function(e){e.preventDefault();var t=L.value,r=C.value,c=E.querySelector(".popup__button");c.textContent="Сохранение...",c.disabled=!0,function(e,t){return fetch("".concat(n,"users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при обновлении данных пользователя: ".concat(e.status))})).catch((function(e){console.error(e)}))}(t,r).then((function(e){j.textContent=e.name,x.textContent=e.about,a(k)})).catch((function(e){return console.log("Ошибка при обновлении данных пользователя:",e)})).finally((function(){c.textContent="Сохранить",c.disabled=!1}))})),B.addEventListener("click",(function(){return a(w)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&a(e)}))})),m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(m.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){return e.preventDefault()}));var t=Array.from(e.querySelectorAll(m.inputSelector)),n=e.querySelector(m.submitButtonSelector);t.forEach((function(e){e.addEventListener("input",(function(){"place-name"===e.name||"name"===e.name?function(e,t){var n=e.value.trim(),o="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";n&&!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(n)?(e.setCustomValidity(o),s(e,o,t)):(e.setCustomValidity(""),d(e,t))}(e,m):d(e,m),p(t,n,m)}))})),p(t,n,m)})),S.addEventListener("submit",(function(e){e.preventDefault();var t,r=b.value,c=q.value,u=S.querySelector(".popup__button");u.textContent="Сохранение...",u.disabled=!0,(t={name:r,link:c},fetch("".concat(n,"cards"),{method:"POST",headers:o.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при добавлении карточки: ".concat(e.status))})).catch((function(e){console.error(e)}))).then((function(e){var t=l(e,M,H);_.prepend(t),a(v),S.reset()})).catch((function(e){return console.log("Ошибка при добавлении карточки:",e)})).finally((function(){u.textContent="Создать",u.disabled=!1}))}));var V=T.querySelector(".popup__confirm-button"),$=T.querySelector(".popup__cancel-button");V.addEventListener("click",(function(){fetch("https://nomoreparties.co/v1/".concat(H,"/cards/").concat(null),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(e){e.message&&(console.log("Карточка удалена:",e),document.getElementById(null).remove(),a(T))})).catch((function(e){return console.log("Ошибка при удалении карточки:",e)}))})),$.addEventListener("click",(function(){return a(T)})),O.addEventListener("click",(function(){return u(D)})),J.addEventListener("click",(function(){return a(D)})),z.addEventListener("input",(function(){z.validity.valid?(N.disabled=!1,N.classList.remove("popup__button_disabled")):(N.disabled=!0,N.classList.add("popup__button_disabled"))})),D.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var o=z.value,r=D.querySelector(".popup__button");r.textContent="Сохранение...",r.disabled=!0,function(e){return fetch("".concat(n,"users/me/avatar"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при обновлении аватара: ".concat(e.status))})).catch((function(e){console.error(e)}))}(o).then((function(){document.querySelector(".profile__avatar").src=o,a(D)})).catch((function(e){return console.log("Ошибка при обновлении аватара:",e)})).finally((function(){r.textContent="Сохранить",r.disabled=!1}))})),Promise.all([fetch("".concat(n,"users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при получении данных пользователя: ".concat(e.status))})).catch((function(e){console.error(e)})),fetch("".concat(n,"cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при получении карточек: ".concat(e.status))})).catch((function(e){console.error(e)}))]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(a.push(o.value),a.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];H=r._id,function(e){e.forEach((function(e){e.owner._id;var t=l(e,M,H);_.append(t)}))}(c)})).catch((function(e){return console.log("Ошибка при загрузке данных:",e)}))})();